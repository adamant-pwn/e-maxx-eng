<!--?title Enumerating generated permutations. Schreier-Sims algorithm -->

# Enumerating generated permutations. Schreier-Sims algorithm

## Permutation groups

### Permutations
Let's recall that permutation of degree $n$ is a sequence $a_1,\dots,a_n$ of distinct integers from $1$ to $n$. Composition of permutations $c = a \circ b$ is defined as $c_i = a_{b_i}$. For permutation composition holds associativity $(a \circ b) \circ c = a \circ (b \circ c)$, there exists neutral permutation $e$ which is $e_i=i$ such that $\forall a \hookrightarrow e \circ a = a \circ e$ and for each permutation $a$ there exists inverse permutation $b$ such that $a \circ b = b \circ a = e$, it can be defined as $b_{a_i} = i$. That means that permutations of degree $n$ form [_group_](https://en.wikipedia.org/wiki/Group_(mathematics)) under the composition operation which is denoted by $S_n$ and called [_symmetric group_](https://en.wikipedia.org/wiki/Symmetric_group) of degree $n$. 

Permutations also can be considered as bijections of set $\Omega = 1,\dots,n$ with itself, that is we can consider permutation $a$ as function that maps set $\Omega$ to itself as $a(x) = a_x$. This makes notion of composition more natural since now $(a \circ b)(x) = a(b(x))$ which is regular [function composition](https://en.wikipedia.org/wiki/Function_composition).

### Problem and notion
You are given $m$ permutations of degree $n$, your task is to calculate size of its generated group. That is, you're given set of permutations $S=\\{a_i\\}_{i=1}^m$ and while it's possible you choose some permutations from this set and add their composition $s_i \circ s_j$ into the set. We will denote denote final set of permutations as $G$. Your task now is to calculate $|G|$, i.e. size of $G$. 

Note that $G$ is group itself which means that it's a [_subgroup_](https://en.wikipedia.org/wiki/Subgroup) of $S_n$. We say that $G$ is [_generated_](https://en.wikipedia.org/wiki/Generating_set_of_a_group) by set $S$ and denote it by $G=\langle S\rangle$. We will denote [_image_](https://en.wikipedia.org/wiki/Image_(mathematics)) of element $\omega \in \Omega$ under the action of $g \in G$ by $\omega^g$ (which would earlier be written as $g_w$). The [_orbit_](https://en.wikipedia.org/wiki/Group_action#Orbits_and_stabilizers) of a point $\omega \in \Omega$ under $G$ is the set $\omega^G = \\{\omega^g | g \in G\\}$. The [_stabilizer_](https://en.wikipedia.org/wiki/Group_action#Orbits_and_stabilizers) of a point $\omega$ is the set $G_\omega=\\{g \in G | \omega^g = \omega\\}$. If $\omega^{a} = \omega$ and $\omega^b = \omega$ then $\omega^{a \circ b} = (\omega^a)^b=\omega$ which means that stabilizer is subgroup of $G$.

### Connection between orbits and stabilizers

For group of permutations $G$ which acts on $\Omega$ holds $|G| = |G_\omega| \cdot |\omega^G|$. 

To prove that we should maintain a notion of [_cosets_](https://en.wikipedia.org/wiki/Coset). Let $H$ be a subgroup of $G$ and $g \in G$. Then $gH=\\{gh | h \in H\\}$ and $Hg = \\{hg | h \in H\\}$ are left and right cosets of $H$ with respect to $g$ correspondingly. It can be proven that cosets for fixed $H$ and different $g$ either coincide or have empty intersection. Indeed if $x \in aH$, $x \in bH$ and $y \in aH$ then $x=ah_1=bh_3, y = ah_2$ and $y = ah_1h_1^{-1}h_2 = xh_1^{-1}h_2 = bh_3h_1^{-1}h_2 = bh_4 \in bH$. As we see, cosets do not intersect, they all has size $|H|$ and their union form the whole $G$ which means that number of cosets is equal to $|G| / |H|$. 

Now we just have to prove that $|\omega^G|$ equals to number of cosets of $|G_\omega|$ which is $|G| / |G_\omega|$. To do this we should note that for each element $\gamma = \omega^h \in \omega^G$ it holds that set $\\{g \in G | \omega^g = \gamma\\}$ is coset of $G_\omega$. Indeed:

$$\\{g\in G | \omega^g = \gamma\\} = \\{g \in G | \omega^g = \omega^h\\}=\\{g \in G | \omega^{g h^{-1}}=\omega\\}=\\{g \in G | g h^{-1} \in G_\omega\\}=\\{g \in G_\omega h\\} = G_\omega h$$

That observation proves the initial statement. This proposition leads to a possible way to calculate order of $G$ generated by few generators $s \in S$. Since $|G|=|G_\omega| \cdot |\omega_G|$, if we could calculate $|\omega^G|$ and find generators for stabilizer $G_\omega$, we would reduce problem to smaller problem of finding the order of generated group $G_\omega$.

### Schreier Trees and Schreier's Lemma

A Schreier tree with root $\alpha$ is a representation of the orbit of $\alpha$ in the following sense: each vertex of this tree corresponds to some element of $\alpha^G$ and edge leading from vertex with element $i$ to vertex with element $j$ holds generator $s \in S$ such that $i^s=j$. This tree can be built via depth first search starting from $\alpha$ and applying all generators $s \in S$ trying to reach new point $\alpha^s$. Time needed to calculate Schreier tree is bounded by $O(mn)$, so $|\alpha^G|$ can be found in efficient way. It turns out that Schreier tree for $\alpha$ can be used to find generators for stabilizer $G_\alpha$:

**Schreier's Lemma.** Let $G=\langle S \rangle$. Then the stabilizer $G_\alpha$ of $\alpha$ is generated by the set of Schreier generators:

$$G_\alpha = \\{t_i s t_{i^s}^{-1} | i \in \alpha^G,s \in S\\}$$

Where $t_i$ is element of $G$ moving $\alpha$ to $i$ (that is $i=\alpha^{t_i}$), i.e. a coset representative of $i$.

## Algorithms
